package io.ergodex.core

import io.ergodex.core.lqmining.simple.{LqMiningPoolBoxSelfHosted, DepositBox, StakingBundleBox}
import org.ergoplatform.ErgoLikeTransaction

object DebugContract extends App with LedgerPlatform {
  val json =
    """
      |{"id":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","inputs":[{"boxId":"0da68d4e2de43b68e666f05546877e14a6f1fd7e3154e5a835a381aeeda176bc","spendingProof":{"proofBytes":"","extension":{}}},{"boxId":"fca62683a88df01b9de7ba001f989bc1a0f838799abdaeee5bb367f6d9f48496","spendingProof":{"proofBytes":"7db8836f9e345f3800a06c91467f97c982cd01916acaf45a00f0e39e962db026e93195cc2eeab8b6023bb828dcbbfa8d5961214917885f0d","extension":{}}},{"boxId":"fd8c7f18a2e360134515e411e268a169a9d8783c76308ff1713ca97b9aefc93f","spendingProof":{"proofBytes":"","extension":{"0":"0408","1":"0404"}}},{"boxId":"8b13011ef535ed36797407334023dec3d9b27f141d45d675c1ba4ee02d97982d","spendingProof":{"proofBytes":"","extension":{"0":"0408","1":"0404"}}}],"dataInputs":[],"outputs":[{"boxId":"12943dec6c1112b2a8e762a7a3c99266374aa6d5238ec3881a384db096800a6e","value":1250000,"ergoTree":"19c0062904000400040204020404040404060406040804080404040204000400040204020601010400040a050005000404040204020e20fc3cdbfd1abc83f4a38ca3fb3dfe417a158b67d63e3c52137fdda4e66ad3956c0400040205000402040204060500050005feffffffffffffffff010502050005000402050005000100d820d601b2a5730000d602db63087201d603db6308a7d604b27203730100d605e4c6a70410d606e4c6a70505d607e4c6a70605d608b27202730200d609b27203730300d60ab27202730400d60bb27203730500d60cb27202730600d60db27203730700d60e8c720d01d60fb27202730800d610b27203730900d6118c721001d6128c720b02d613998c720a027212d6148c720902d615b27205730a00d6169a99a37215730bd617b27205730c00d6189d72167217d61995919e72167217730d9a7218730e7218d61ab27205730f00d61b7e721a05d61c9d7206721bd61d998c720c028c720d02d61e8c721002d61f998c720f02721ed6207310d1ededededed93b272027311007204ededed93e4c672010410720593e4c672010505720693e4c6720106057207928cc77201018cc7a70193c27201c2a7ededed938c7208018c720901938c720a018c720b01938c720c01720e938c720f01721193b172027312959172137313d802d6219c721399721ba273147e721905d622b2a5731500ededed929a997206721472079c7e9995907219721a72199a721a7316731705721c937213f0721d937221f0721fedededed93cbc272227318938602720e7213b2db6308722273190093860272117221b2db63087222731a00e6c67222040893e4c67222050e8c720401958f7213731bededec929a997206721472079c7e9995907219721a72199a721a731c731d05721c92a39a9a72159c721a7217b27205731e0093721df0721392721f95917219721a731f9c721d99721ba273207e721905d804d621e4c672010704d62299721a7221d6237e722205d62499997321721e9c9972127322722395ed917224732391721f7324edededed9072219972197325909972149c7223721c9a721c7207907ef0998c7208027214069a9d9c99997e7214069d9c7e7206067e7222067e721a0672207e721f067e7224067220937213732693721d73277328","assets":[{"tokenId":"48e744055c9e49b26d1c70eca3c848afc8f50eddf8962a33f3d4b5df3d771ac2","amount":1},{"tokenId":"00bd762484086cf560d3127eb53f0769d76244d9737636b2699d55c56cd470bf","amount":4000003},{"tokenId":"e7021bda9872a7eb2aa69dd704e6a997dae9d1b40d1ff7a50e426ef78c6f6f87","amount":30001},{"tokenId":"81f307da6c294bb9ee1c8789dfeff5b97c2399451e099ab6c9985a55551e41dd","amount":9223372036854745807},{"tokenId":"b19b810cc4dbc4bfaca74f88bb3797dcd8bab766ab360c275f3bc5b0476a50a9","amount":9223372036854655807}],"additionalRegisters":{"R7":"0402","R6":"05d00f","R4":"1004f4030aa69872c801","R5":"05feace204"},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":0},{"boxId":"f146d9aef5fdc97b1918518f6d1b8d4c981954e4939d42909cbbf8994cc7a3a3","value":9973750000,"ergoTree":"0008cd03b0b2ce2839747f5e4d3c304a0dd67b47f29649a48e19c5cbb7b93aad106911df","assets":[],"additionalRegisters":{},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":1},{"boxId":"7f36c6d2716cef21642e07ccc8499a65b3d1dbf17d96b2c44f3402abe5b3afe5","value":1250000,"ergoTree":"19a3041f040004000404040404000402060101040005000402040404020400040004020502040405020402040005feffffffffffffffff010408050205000404040004060404040205fcffffffffffffffff010100d80cd601b2a5730000d602db63087201d603e4c6a7050ed604b2a4730100d605db63087204d6068cb2720573020002d607998cb27202730300027206d608e4c6a70408d609db6308a7d60ab27209730400d60bb27205730500d60c7306d1ed938cb27202730700017203959372077308d80cd60db2a5e4e3000400d60eb2a5e4e3010400d60fb2e4c672040410730900d610c672010804d61199720f95e67210e47210e4c672010704d6128cb27209730a0001d613db6308720ed614b27209730b00d6158c721402d6167e721105d6179972159c72168c720a02d618b2db6308720d730c00eded93c2720dd07208edededed93e4c6720e0408720893e4c6720e050e720393c2720ec2a795917211730dd801d619b27213730e00eded9386027212730fb27213731000938c7219018c721401939972158c721902721793860272127311b2721373120093b27213731300720aed938c7218018c720b01927e8c7218020699999d9c99997e8c720b02069d9c7ee4c672040505067e7211067e720f06720c7e7217067e999973148cb27205731500029c9972067316721606720c720c958f7207731793b2db6308b2a473180073190086029593b17209731a8cb27209731b00018cb27209731c0001731d731e","assets":[{"tokenId":"81f307da6c294bb9ee1c8789dfeff5b97c2399451e099ab6c9985a55551e41dd","amount":20000},{"tokenId":"b19b810cc4dbc4bfaca74f88bb3797dcd8bab766ab360c275f3bc5b0476a50a9","amount":80000},{"tokenId":"250c76c79dc87ff13272b8f5e59d8b66a7aa2fcd7ae76d0cf7bb0edc8ce0b7db","amount":1}],"additionalRegisters":{"R5":"0e2048e744055c9e49b26d1c70eca3c848afc8f50eddf8962a33f3d4b5df3d771ac2","R4":"08cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491"},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":2},{"boxId":"4803948ff96f1c8bd61824904212d8d203b9a7a9d3cd4754a12db639d22db572","value":1250000,"ergoTree":"19a3041f040004000404040404000402060101040005000402040404020400040004020502040405020402040005feffffffffffffffff010408050205000404040004060404040205fcffffffffffffffff010100d80cd601b2a5730000d602db63087201d603e4c6a7050ed604b2a4730100d605db63087204d6068cb2720573020002d607998cb27202730300027206d608e4c6a70408d609db6308a7d60ab27209730400d60bb27205730500d60c7306d1ed938cb27202730700017203959372077308d80cd60db2a5e4e3000400d60eb2a5e4e3010400d60fb2e4c672040410730900d610c672010804d61199720f95e67210e47210e4c672010704d6128cb27209730a0001d613db6308720ed614b27209730b00d6158c721402d6167e721105d6179972159c72168c720a02d618b2db6308720d730c00eded93c2720dd07208edededed93e4c6720e0408720893e4c6720e050e720393c2720ec2a795917211730dd801d619b27213730e00eded9386027212730fb27213731000938c7219018c721401939972158c721902721793860272127311b2721373120093b27213731300720aed938c7218018c720b01927e8c7218020699999d9c99997e8c720b02069d9c7ee4c672040505067e7211067e720f06720c7e7217067e999973148cb27205731500029c9972067316721606720c720c958f7207731793b2db6308b2a473180073190086029593b17209731a8cb27209731b00018cb27209731c0001731d731e","assets":[{"tokenId":"81f307da6c294bb9ee1c8789dfeff5b97c2399451e099ab6c9985a55551e41dd","amount":10000},{"tokenId":"b19b810cc4dbc4bfaca74f88bb3797dcd8bab766ab360c275f3bc5b0476a50a9","amount":40000},{"tokenId":"cba6fabbc040c49873d3dea062a7fc81ff3262e1799dfd41e05014c5e8d91109","amount":1}],"additionalRegisters":{"R4":"08cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491","R5":"0e2048e744055c9e49b26d1c70eca3c848afc8f50eddf8962a33f3d4b5df3d771ac2"},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":3},{"boxId":"a09ff5274d63c318b83f4ef5968cd45037f34f520eb6a5dd469e561587577997","value":250000,"ergoTree":"0008cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491","assets":[{"tokenId":"00bd762484086cf560d3127eb53f0769d76244d9737636b2699d55c56cd470bf","amount":666665}],"additionalRegisters":{},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":4},{"boxId":"55098af8de430c123c2e1dc6b4167456986768519383a0348c06164230f2b0f5","value":250000,"ergoTree":"0008cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491","assets":[{"tokenId":"00bd762484086cf560d3127eb53f0769d76244d9737636b2699d55c56cd470bf","amount":333332}],"additionalRegisters":{},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":5},{"boxId":"5ea25290acf7fef11a3a975e2e363b6bebe002e4c45ebe0e8d0cd62ea5fa1036","value":1000000,"ergoTree":"1005040004000e36100204a00b08cd0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ea02d192a39a8cc7a701730073011001020402d19683030193a38cc7b2a57300000193c2b2a57301007473027303830108cdeeac93b1a57304","assets":[],"additionalRegisters":{},"creationHeight":935823,"transactionId":"730a70fe43392385462d837a266dd813e0b4a032fcd62cfd8795318ac675beab","index":6}]}
      |""".stripMargin

  val Right(tx) = io.circe.parser.decode[ErgoLikeTransaction](json)

  val (inputs, outputs) = pullIOs(tx)

  val Some(setupPool) = RuntimeSetup.fromIOs[StakingBundleBox](inputs, outputs, 3, 935823)
  //val Some(setupDeposit) = RuntimeSetup.fromIOs[DepositBox](inputs, outputs, 0, 927426)

  println(setupPool.run.value)
  //println(setupDeposit.run.value)
}
