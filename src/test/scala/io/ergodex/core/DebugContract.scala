package io.ergodex.core

import io.ergodex.core.lqmining.simple.{LqMiningPoolBoxSelfHosted, DepositBox, StakingBundleBox}
import org.ergoplatform.ErgoLikeTransaction

object DebugContract extends App with LedgerPlatform {
  val json =
    """
      |{"id":"533285fde59b811b55b5b6eb025a515e35250811c55ad7e4b68cca9b9a5ef016","inputs":[{"boxId":"b709b818f7086dac821df578b8c005e507407e4adaaaa3aa9c64a38fde0586d3","spendingProof":{"proofBytes":"346e17a447243f6a8e8b3036352b64e7d06522480e11c4aa1a317b4ebf2e8ebd01c9625e08b77d042e77662af89f19f248f8f27e2e047e32","extension":{}}},{"boxId":"5b0eae2cc6f8d8ef743d1f969f5a0b87cf8220498ccfe3cf466d61b25e3ab216","spendingProof":{"proofBytes":"346e17a447243f6a8e8b3036352b64e7d06522480e11c4aa1a317b4ebf2e8ebd01c9625e08b77d042e77662af89f19f248f8f27e2e047e32","extension":{}}},{"boxId":"36a01e2bfcd5894edb2f986081a88f41b36dc3938889f20b37638272a88fd21d","spendingProof":{"proofBytes":"346e17a447243f6a8e8b3036352b64e7d06522480e11c4aa1a317b4ebf2e8ebd01c9625e08b77d042e77662af89f19f248f8f27e2e047e32","extension":{}}}],"dataInputs":[],"outputs":[{"boxId":"fb1faf86bc98256b482dd4260ba032a08b838f405f0d411bcdd88497f9403d5e","value":1250000,"ergoTree":"199d062704000400040204020404040404060406040804080404040204000400040204020601010400040a0500050004040e20e23e8fd028861053de63070f49e9584e9605fb0cdc21daeb04fb1ba36fc3c47e0400040205000402040204060500050005feffffffffffffffff010502050005000402050005000100d820d601b2a5730000d602db63087201d603db6308a7d604b27203730100d605e4c6a70410d606e4c6a70505d607e4c6a70605d608b27202730200d609b27203730300d60ab27202730400d60bb27203730500d60cb27202730600d60db27203730700d60e8c720d01d60fb27202730800d610b27203730900d6118c721001d6128c720b02d613998c720a027212d614998c720c028c720d02d615b27205730a00d6169a99a37215730bd617b27205730c00d6189d72167217d61995919e72167217730d9a7218730e7218d61ab27205730f00d61b7e721a05d61c8c721002d61d998c720f02721cd61e8c720902d61f9d7206721bd6207310d1ededededed93b272027311007204ededed93e4c672010410720593e4c672010505720693e4c6720106057207928cc77201018cc7a70193c27201c2a7ededed938c7208018c720901938c720a018c720b01938c720c01720e938c720f01721193b172027312959172137313d802d6219c721399721ba273147e721905d622b2a5731500eded937213f07214937221f0721dedededed93cbc272227316938602720e7213b2db6308722273170093860272117221b2db63087222731800e6c67222040893e4c67222050e8c720401958f72137319ededec929a997206721e72079c7e9995907219721a72199a721a731a731b05721f92a39a9a72159c721a7217b27205731c00937214f0721392721d95917219721a731d9c721499721ba2731e7e721905d804d621e4c672010704d62299721a7221d6237e722205d6249999731f721c9c9972127320722395ed917224732191721d7322edededed90722199721973239099721e9c7223721f9a721f7207907ef0998c720802721e069a9d9c99997e721e069d9c7e7206067e7222067e721a0672207e721d067e7224067220937213732493721473257326","assets":[{"tokenId":"0b4cb897eb6fd9edeb27cb5591cabf00f126b24f37a5830a2f62140aa220e1ea","amount":1},{"tokenId":"00bd762484086cf560d3127eb53f0769d76244d9737636b2699d55c56cd470bf","amount":3000000},{"tokenId":"e7021bda9872a7eb2aa69dd704e6a997dae9d1b40d1ff7a50e426ef78c6f6f87","amount":1001},{"tokenId":"2e98b9629d46407be503d5f217acdfe5ad67e9a014ccbdb7e5534c8a9a7b0612","amount":9223372036854774807},{"tokenId":"505a280e6f5d30cfc721d9be050dfe621221b758c553760e0060757be2a12217","amount":9223372036854765807}],"creationHeight":927426,"additionalRegisters":{"R4":"1004f40314c69c71c801","R5":"05fe9aee02","R6":"05d00f"},"transactionId":"533285fde59b811b55b5b6eb025a515e35250811c55ad7e4b68cca9b9a5ef016","index":0},{"boxId":"bbfae951ece422c7ecf9aa109ba77dd9f716c034b58f3e4d132c3eaec262f112","value":1250000,"ergoTree":"0008cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491","assets":[{"tokenId":"b709b818f7086dac821df578b8c005e507407e4adaaaa3aa9c64a38fde0586d3","amount":9223372036854775806}],"creationHeight":927426,"additionalRegisters":{},"transactionId":"533285fde59b811b55b5b6eb025a515e35250811c55ad7e4b68cca9b9a5ef016","index":1},{"boxId":"4de4645c02f7608e2afd9cb0ad2eddf3b1b8976225eb1e5cc6c37a2a175e1025","value":1250000,"ergoTree":"198f041d04000400040404040400040206010104080400050004020402040204000404050204040400040805feffffffffffffffff01050205000404040004060404040205fcffffffffffffffff010100d80dd601b2a5730000d602db63087201d603e4c6a7050ed604b2a4730100d605db63087204d6068cb2720573020002d607998cb27202730300027206d608e4c6a70408d609db6308a7d60ab27209730400d60bb27205730500d60c7306d60d8cb2720573070002d1ed938cb27202730800017203959372077309d80bd60eb2a5e4e3000400d60fb2a5e4e3010400d610db6308720fd611b27210730a00d612b27209730b00d6138c721202d614b2e4c672040410730c00d615c672010804d61699721495e67215e47215e4c672010704d6177e721605d618b2db6308720e730d00eded93c2720ed07208edededededed93e4c6720f0408720893e4c6720f050e720393c2720fc2a79386028cb27209730e0001730fb27210731000938c7211018c721201939972138c7211029972139c72178c720a0293b27210731100720aed938c7218018c720b01927e8c7218020699999d9c99997e8c720b02069d9c7ee4c672040505067e7216067e721406720c7e998cb2720273120002720d067e99997313720d9c9972067314721706720c720c958f7207731593b2db6308b2a473160073170086029593b1720973188cb27209731900018cb27209731a0001731b731c","assets":[{"tokenId":"2e98b9629d46407be503d5f217acdfe5ad67e9a014ccbdb7e5534c8a9a7b0612","amount":1000},{"tokenId":"505a280e6f5d30cfc721d9be050dfe621221b758c553760e0060757be2a12217","amount":10000},{"tokenId":"b709b818f7086dac821df578b8c005e507407e4adaaaa3aa9c64a38fde0586d3","amount":1}],"creationHeight":927426,"additionalRegisters":{"R4":"08cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491","R5":"0e200b4cb897eb6fd9edeb27cb5591cabf00f126b24f37a5830a2f62140aa220e1ea"},"transactionId":"533285fde59b811b55b5b6eb025a515e35250811c55ad7e4b68cca9b9a5ef016","index":2},{"boxId":"e258fa7e76e0136d8cea9ec3fcd95e0196462d0e458ec5a4926bcd55282ae85b","value":1250000,"ergoTree":"1005040004000e36100204a00b08cd0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ea02d192a39a8cc7a701730073011001020402d19683030193a38cc7b2a57300000193c2b2a57301007473027303830108cdeeac93b1a57304","assets":[],"creationHeight":927426,"additionalRegisters":{},"transactionId":"533285fde59b811b55b5b6eb025a515e35250811c55ad7e4b68cca9b9a5ef016","index":3},{"boxId":"971862796ee97f81c2a1774354c17a37c3b6d321a6424ab0a8a44e265c62c463","value":2972500000,"ergoTree":"0008cd03e02fa2bbd85e9298aa37fe2634602a0fba746234fe2a67f04d14deda55fac491","assets":[{"tokenId":"00bd762484086cf560d3127eb53f0769d76244d9737636b2699d55c56cd470bf","amount":41000000},{"tokenId":"e7021bda9872a7eb2aa69dd704e6a997dae9d1b40d1ff7a50e426ef78c6f6f87","amount":49996997}],"creationHeight":927426,"additionalRegisters":{},"transactionId":"533285fde59b811b55b5b6eb025a515e35250811c55ad7e4b68cca9b9a5ef016","index":4}]}
      |""".stripMargin

  val Right(tx) = io.circe.parser.decode[ErgoLikeTransaction](json)

  val (inputs, outputs) = pullIOs(tx)

  val Some(setupPool) = RuntimeSetup.fromIOs[LqMiningPoolBoxSelfHosted](inputs, outputs, 0, 927426)
  val Some(setupDeposit) = RuntimeSetup.fromIOs[DepositBox](inputs, outputs, 0, 927426)

  println(setupPool.run.value)
  println(setupDeposit.run.value)
}
